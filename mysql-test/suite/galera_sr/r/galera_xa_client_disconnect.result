connection node_2;
connection node_1;
connect node_1a, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connection node_1;
CREATE TABLE t1 (f1 INTEGER PRIMARY KEY) Engine=InnoDB;
XA START 'test';
INSERT INTO t1 VALUES (1);
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (3);
INSERT INTO t1 VALUES (4);
disconnect node_1;
connection node_1a;
SELECT COUNT(*) AS expect_0 FROM t1;
expect_0
0
SELECT COUNT(*) AS expect_0 FROM mysql.wsrep_streaming_log;
expect_0
0
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_2;
SELECT COUNT(*) AS expect_0 FROM t1;
expect_0
0
SELECT COUNT(*) AS expect_0 FROM mysql.wsrep_streaming_log;
expect_0
0
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_1a;
DROP TABLE t1;
connect node_1, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connect trx1, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connection trx1;
CREATE TABLE t1 (f1 INTEGER PRIMARY KEY) Engine=InnoDB;
XA START 'trx1';
INSERT INTO t1 VALUES (1);
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (3);
INSERT INTO t1 VALUES (4);
XA END 'trx1';
XA PREPARE 'trx1';
disconnect trx1;
connect trx2, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connection trx2;
XA START 'trx2';
INSERT INTO t1 VALUES (5);
INSERT INTO t1 VALUES (6);
INSERT INTO t1 VALUES (7);
INSERT INTO t1 VALUES (8);
XA END 'trx2';
XA PREPARE 'trx2';
disconnect trx2;
connection node_1;
SELECT * FROM t1;
f1
SELECT xid FROM mysql.wsrep_streaming_log;
xid
X'74727831',X'',1
X'74727832',X'',1
XA RECOVER;
formatID	gtrid_length	bqual_length	data
1	4	0	trx2
1	4	0	trx1
connection node_2;
SELECT * FROM t1;
f1
SELECT xid FROM mysql.wsrep_streaming_log;
xid
X'74727831',X'',1
X'74727832',X'',1
XA RECOVER;
formatID	gtrid_length	bqual_length	data
1	4	0	trx2
1	4	0	trx1
connection node_1a;
XA COMMIT 'trx1';
XA ROLLBACK 'trx2';
SELECT * FROM t1;
f1
1
2
3
4
SELECT xid FROM mysql.wsrep_streaming_log;
xid
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_2;
SELECT * FROM t1;
f1
1
2
3
4
SELECT xid FROM mysql.wsrep_streaming_log;
xid
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_1a;
DROP TABLE t1;
connection node_1;
CREATE TABLE t1 (f1 INTEGER PRIMARY KEY) Engine=InnoDB;
INSERT INTO t1 VALUES (1);
XA START 'test';
SELECT * FROM t1;
f1
1
XA END 'test';
XA PREPARE 'test';
disconnect node_1;
connection node_1a;
SELECT * FROM t1;
f1
1
SELECT xid FROM mysql.wsrep_streaming_log;
xid
X'74657374',X'',1
XA RECOVER;
formatID	gtrid_length	bqual_length	data
1	4	0	test
connection node_2;
SELECT * FROM t1;
f1
1
SELECT xid FROM mysql.wsrep_streaming_log;
xid
X'74657374',X'',1
XA RECOVER;
formatID	gtrid_length	bqual_length	data
1	4	0	test
connection node_1a;
XA COMMIT 'test';
SELECT * FROM t1;
f1
1
SELECT xid FROM mysql.wsrep_streaming_log;
xid
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_2;
SELECT * FROM t1;
f1
1
SELECT xid FROM mysql.wsrep_streaming_log;
xid
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_1a;
DROP TABLE t1;
connect node_1, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connection node_1;
CREATE TABLE t1 (f1 INTEGER PRIMARY KEY) Engine=InnoDB;
XA START 'test';
INSERT INTO t1 VALUES (1);
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (3);
INSERT INTO t1 VALUES (4);
connection node_1a;
connection node_1a;
SELECT COUNT(*) AS expect_0 FROM t1;
expect_0
0
SELECT COUNT(*) AS expect_0 FROM mysql.wsrep_streaming_log;
expect_0
0
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_2;
SELECT COUNT(*) AS expect_0 FROM t1;
expect_0
0
SELECT COUNT(*) AS expect_0 FROM mysql.wsrep_streaming_log;
expect_0
0
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_1;
DROP TABLE t1;
connect trx1, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connection trx1;
CREATE TABLE t1 (f1 INTEGER PRIMARY KEY) Engine=InnoDB;
XA START 'trx1';
INSERT INTO t1 VALUES (1);
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (3);
INSERT INTO t1 VALUES (4);
XA END 'trx1';
XA PREPARE 'trx1';
connect trx2, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connection trx2;
XA START 'trx2';
INSERT INTO t1 VALUES (5);
INSERT INTO t1 VALUES (6);
INSERT INTO t1 VALUES (7);
INSERT INTO t1 VALUES (8);
XA END 'trx2';
XA PREPARE 'trx2';
connection node_1;
SELECT * FROM t1;
f1
SELECT xid FROM mysql.wsrep_streaming_log;
xid
X'74727831',X'',1
X'74727832',X'',1
XA RECOVER;
formatID	gtrid_length	bqual_length	data
1	4	0	trx2
1	4	0	trx1
connection node_2;
SELECT * FROM t1;
f1
SELECT xid FROM mysql.wsrep_streaming_log;
xid
X'74727831',X'',1
X'74727832',X'',1
XA RECOVER;
formatID	gtrid_length	bqual_length	data
1	4	0	trx2
1	4	0	trx1
connection node_1a;
XA COMMIT 'trx1';
XA ROLLBACK 'trx2';
SELECT * FROM t1;
f1
1
2
3
4
SELECT xid FROM mysql.wsrep_streaming_log;
xid
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_2;
SELECT * FROM t1;
f1
1
2
3
4
SELECT xid FROM mysql.wsrep_streaming_log;
xid
XA RECOVER;
formatID	gtrid_length	bqual_length	data
connection node_1a;
DROP TABLE t1;
